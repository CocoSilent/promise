{"version":3,"file":"promise.js","sources":["../src/type.ts","../src/promise.ts"],"sourcesContent":["export type OnFulfilled = (value?: any) => void\r\nexport type OnRejected  = (reason?: any) => void\r\nexport type Executor = (OnFulfilled, OnRejected) => void\r\n\r\nexport enum PromiseState {\r\n    'PENDING',\r\n    'FULLFILLED',\r\n    'REJECTED'\r\n}","import {Executor, OnFulfilled, OnRejected, PromiseState} from './type';\r\n\r\n// 异步任务，nodejs微任务  浏览器宏任务\r\nconst asyncTask = (fun) => {\r\n    if (process && process.nextTick) {\r\n        // microtask\r\n        process.nextTick(fun)\r\n    } else {\r\n        // macrotask\r\n        setTimeout(fun);\r\n    }\r\n}\r\n\r\nexport default class Promise {\r\n    private PromiseState: PromiseState;\r\n    private PromiseResult: any;\r\n    private readonly resolve: OnFulfilled\r\n    private readonly reject: OnRejected;\r\n    constructor(executor: Executor) {\r\n        this.PromiseState = null;\r\n\r\n        this.resolve = function (value: any) {\r\n            this.PromiseState = PromiseState.FULLFILLED;\r\n            this.PromiseResult = value;\r\n        }\r\n\r\n        this.reject = function (reason: any) {\r\n            this.PromiseState = PromiseState.REJECTED;\r\n            this.PromiseResult = reason;\r\n        }\r\n\r\n        try {\r\n            executor(this.resolve.bind(this), this.reject.bind(this));\r\n        } catch (e) {\r\n            this.reject(e);\r\n        }\r\n    }\r\n    then(onFulfilled: OnFulfilled, onRejected:OnRejected) {\r\n        const promise2 = new Promise((resolve, reject) => {\r\n            if (this.PromiseState === PromiseState.FULLFILLED) {\r\n                onFulfilled(this.PromiseResult);\r\n            } else if (this.PromiseState === PromiseState.REJECTED) {\r\n                onRejected(this.PromiseResult);\r\n            } else if (this.PromiseState === PromiseState.PENDING) {\r\n\r\n            }\r\n        });\r\n        return promise2;\r\n    }\r\n}"],"names":[],"mappings":";;;;;;IAIA,IAAY,YAIX;IAJD,WAAY,YAAY;QACpB,qDAAS,CAAA;QACT,2DAAY,CAAA;QACZ,uDAAU,CAAA;IACd,CAAC,EAJW,YAAY,KAAZ,YAAY;;;QCcpB,iBAAY,QAAkB;YAC1B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;YAEzB,IAAI,CAAC,OAAO,GAAG,UAAU,KAAU;gBAC/B,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC,UAAU,CAAC;gBAC5C,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;aAC9B,CAAA;YAED,IAAI,CAAC,MAAM,GAAG,UAAU,MAAW;gBAC/B,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC,QAAQ,CAAC;gBAC1C,IAAI,CAAC,aAAa,GAAG,MAAM,CAAC;aAC/B,CAAA;YAED,IAAI;gBACA,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;aAC7D;YAAC,OAAO,CAAC,EAAE;gBACR,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;aAClB;SACJ;QACD,sBAAI,GAAJ,UAAK,WAAwB,EAAE,UAAqB;YAApD,iBAWC;YAVG,IAAM,QAAQ,GAAG,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;gBACzC,IAAI,KAAI,CAAC,YAAY,KAAK,YAAY,CAAC,UAAU,EAAE;oBAC/C,WAAW,CAAC,KAAI,CAAC,aAAa,CAAC,CAAC;iBACnC;qBAAM,IAAI,KAAI,CAAC,YAAY,KAAK,YAAY,CAAC,QAAQ,EAAE;oBACpD,UAAU,CAAC,KAAI,CAAC,aAAa,CAAC,CAAC;iBAClC;qBAAM,IAAI,KAAI,CAAC,YAAY,KAAK,YAAY,CAAC,OAAO,EAAE,CAEtD;aACJ,CAAC,CAAC;YACH,OAAO,QAAQ,CAAC;SACnB;QACL,cAAC;IAAD,CAAC;;;;;;;;"}